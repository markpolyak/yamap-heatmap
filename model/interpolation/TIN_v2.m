%---- Коорд-ты левого верхнего угла ----
y1 = 60.239214;
x1 = 29.103127;

%---- Коорд-ты пр. ниж. угла ----
y2 = 59.835767;
x2 = 30.375137;

 
D = [60.0833333333333 29.4333333333333 1.24000000000000; 
      59.9766666666667 29.6150000000000 3.31999993300000; 
      60.0833333333333 29.7283333333333 9.19999980900000;
      60.0666666666667 29.1333333333333 6.59999990500000;
      59.9600000000000 29.9816666666667 10.6499996200000; 
      59.9900000000000 29.8583333333333 8.89999961900000; 
      59.9583333333333 29.7966666666667 8.07999992400000; 
      59.9366666666667 29.7883333333333 8.72999954200000; 
      60 29.9383333333333 4.61999988600000; 
      59.9383333333333 30.1283333333333 6.07999992400000; 
      59.9016666666667 30.0866666666667 20; 
      59.8850000000000 30.1666666666667 11.9300003100000; 
      59.9783333333333 30.2166666666667 0.899999976000000; 
      59.9666666666667 30.2183333333333 0.0500000010000000; 
      59.8883333333333 30.2183333333333 2.67000007600000; 
      59.9166666666667 30.2633333333333 18.4200000000000; 
      60.1150000000000 29.8733333333333 0.0200000000000000];

 
extraPoints = [59.9354735000362 29.6722798375239;
            60.0373101804513 29.9565510777584;
            60.0142868323772 29.9654774693599;
            59.9991582646393 30.0121693638912;
            59.997094740078 30.0684742955318;
            59.9888393502842 30.1288991002193;
            59.9833346089204 30.1941304234615;
            59.9633722197987 30.2167897252193;
            59.9327167923843 30.2112965611568;
            59.9051370691063 30.2085499791255;
            59.8806407981471 30.1714711217037;
            59.8616523537842 30.1330189732662;
            59.8619976953451 30.0629811314693;
            59.8685585015234 29.9970631627193;
            59.8854724832936 29.9496846226802;
            59.8892683129267 29.8933796910396;
            59.9023778318175 29.8322682408443;
            59.9172060277456 29.7766499547115;
            59.9289259439731 29.7217183140865;
            60.0593191155312 29.9626649567371;
            60.0884851683079 29.9527085968738;
            60.1172826749943 29.9479020783192;
            60.1446853960649 29.9334825226551;
            60.1614582581908 29.8751176544909;
            60.1761702284088 29.801646585155;
            60.1871143821973 29.735728616405;
            60.1925850868558 29.6684373566394;
            60.1990803606281 29.5963395783191;
            60.1932688606222 29.5283616730456;
            60.1768543452382 29.4645036408191;
            60.1628270924027 29.4157518097644;
            60.1628270924027 29.3422807404283;
            60.1621426824473 29.2688096710924;
            60.1659067602324 29.1967118927721;
            60.17069677907 29.1040147492174;
            60.1429733967372 29.1047013947252;
            60.1035727266569 29.1047013947252;
            60.0636098640611 29.1047013947252;
            60.0290963995285 29.1047013947254;
            59.9957505557488 29.1040147492176;
            59.9644366537339 29.1040147492176;
            59.976828123943 29.1781724640614;
            59.9740748659036 29.2605699249989;
            59.9706329703267 29.3470872589833;
            59.9554843652001 29.4336045929677;
            59.9547956270909 29.5050157257802;
            59.953073718982 29.5599473664052;
            59.9361942684933 29.5956529328115;
            59.9282682871546 29.6272386261708];

 Z_extraPoints = idw_interp(D(:,2),D(:,1),D(:,3),extraPoints(:,2),extraPoints(:,1), -2,'ng',2);
 for i = 1 : length(extraPoints)
    extraPoints(i,3) = Z_extraPoints(i,i); 
 end
 
 points = cat(1, D, extraPoints);
 
n = 6000;
k = 6000;

 
stepX = (x2 - x1) / n;
stepY = (y2 - y1) / k;
 
%---- Массив коорд-т точек сетки по X ----
mX = [];
%---- Массив коорд-т точек сетки по Y ----
mY = [];
 
for i = 1:n
    for j = 1:k
        mX(i) = x1 + i * stepX;
        mY(j) = y1 + j * stepY; 
    end
end


[X,Y] = meshgrid(mX,mY);

x = points(:,2);
y = points(:,1);
z = points(:,3);

Z = griddata(x,y,z,X(1,:),Y(:,1),'linear');
DT = delaunay(x,y);

figure('Name','TIN');
clmp=colorGradient([1 1 1], [0 0.75 0.2], 64);

c = imread('big map.jpg');
image([29.103127,30.375137], [59.835767,60.239214], flipud(c));
axis on
set(gca,'YDir','normal');
hold on

%imagesc(X(1,:),Y(:,1), Z); axis xy
%colormap(clmp);
%colorbar;%('TickLabels',{'0','2','4','6','8','10','12','14','16','18','20'})
%hold on

%[img, map, alphachannel] = imread('big map.png');
%imagesc([29.103127,30.375137], [59.835767,60.239214], img, 'AlphaData', alphachannel);

triplot(DT,x,y);
plot(D(:, 2), D(:, 1), 'or')
plot(extraPoints(:, 2), extraPoints(:, 1), 'ok')